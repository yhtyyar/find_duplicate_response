# Поиск дубликатов в логах HTTP запросов

Это приложение находит дублирующиеся записи в CSV файлах логов HTTP запросов на основе URL, метода HTTP, кода ответа и статуса.

## Структура проекта

- `model.py` - Логика обработки данных
- `view.py` - Функции отображения
- `controller.py` - Основная логика приложения (CLI)
- `api.py` - Реализация REST API
- `res/` - Примеры файлов данных

## Возможности

- Чтение CSV файлов с логами HTTP запросов
- Определение дублирующихся записей на основе URL, метода, кода ответа и статуса
- Цветная индикация для лучшей визуализации (CLI)
- REST API для программного доступа
- Улучшенная визуальная группировка дубликатов
- Специальная подсветка для кодов ошибок (4xx и 5xx)
- Улучшенная цветовая схема для лучшей читаемости
- **Учет query-параметров при сравнении URL** - запросы с разными параметрами считаются разными

## Использование

### Командная строка

```bash
# Запуск с файлом по умолчанию
python controller.py

# Запуск с указанием конкретного файла
python controller.py path/to/your/file.csv
```

### REST API

```bash
# Запуск сервера API
python api.py

# API будет доступен по адресу http://localhost:5000

# Проверка состояния сервиса
curl http://localhost:5000/health

# Поиск дубликатов
curl -X POST -F "file=@path/to/your/file.csv" http://localhost:5000/find-duplicates
```

## Требования

- Python 3.x
- Flask

Установка зависимостей:
```bash
pip install -r requirements.txt
```

## Как это работает

1. Приложение читает CSV файл с логами HTTP запросов
2. Определяет дублирующиеся записи на основе комбинации:
   - URL (с учетом query-параметров)
   - Метод HTTP (GET, POST, и т.д.)
   - Код ответа (200, 404, и т.д.)
   - Статус (COMPLETE, ERROR, и т.д.)

### Особенности обработки URL

При сравнении URL приложение учитывает query-параметры:
- `https://example.com/api?user=1&event=play` и `https://example.com/api?user=1&event=play` - дубликаты
- `https://example.com/api?user=1&event=play` и `https://example.com/api?user=2&event=play` - разные запросы
- `https://example.com/api?user=1&event=play` и `https://example.com/api?event=play&user=1` - разные запросы (разный порядок параметров)

## Вывод

Приложение отображает:
- Общее количество обработанных строк
- Количество найденных дубликатов
- Подробный список дублирующихся записей с визуальной группировкой

## Конечные точки API

- `GET /health` - Проверка состояния сервиса
- `POST /find-duplicates` - Поиск дубликатов в загруженном CSV файле
- `GET /` - Простой HTML интерфейс для тестирования

Конечная точка POST `/find-duplicates` ожидает multipart/form-data запрос с полем 'file', содержащим CSV файл.

## Цветовая кодировка

- **Зеленый**: Успешные ответы (2xx)
- **Желтый**: Ответы с перенаправлением (3xx)
- **Красный**: Ошибки клиента (4xx)
- **Пурпурный**: Ошибки сервера (5xx)
- **Синий/Другие цвета**: Разные группы дубликатов для легкой визуальной идентификации

CLI версия использует светлую цветовую схему для лучшей читаемости.